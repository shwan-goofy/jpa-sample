# 1. 프로젝트 환경설정

## 프로젝트 생성
* 스프링 부트 스타터(https://start.spring.io/)를 사용해서 프로젝트를 생성합니다.
* **Project**: Gradle - Groovy Project
* **사용 기능**: web, jpa, h2, lombok
* **Spring Boot Version**: 3.x.x
* **Group**: study
* **Artifact**: data-jpa

**주의! - 스프링 부트 3.x 버전 선택 필수**
* `start.spring.io` 사이트에서 스프링 부트 2.x에 대한 지원이 종료되어서 더는 선택할 수 없습니다.
* 이제는 스프링 부트 3.0 이상을 선택해주세요.

**스프링 부트 3.0을 선택하게 되면 다음 부분을 꼭 확인해주세요.**
1. **Java 17 이상**을 사용해야 합니다.
2. **javax 패키지 이름**을 **jakarta**로 변경해야 합니다.
    * 오라클과 자바 라이센스 문제로 모든 javax 패키지를 jakarta로 변경하기로 했습니다.
3. **H2 데이터베이스**를 **2.1.214 버전 이상** 사용해주세요.

## H2 데이터베이스 설치
* 개발이나 테스트 용도로 가볍고 편리한 DB, 웹 화면 제공
* [https://www.h2database.com](https://www.h2database.com)
* 스프링 부트 3.x를 사용하면 2.1.214 버전 이상 사용해야 합니다.
* H2 데이터베이스의 MVCC 옵션은 H2 1.4.198 버전부터 제거되었습니다. 최신 버전에서는 MVCC 옵션을 사용하면 오류가 발생합니다.

## 스프링 데이터 JPA와 DB 설정, 동작확인
* `application.yml` 파일에 다음과 같이 DB 설정을 합니다.
    * `spring.datasource.url`: `jdbc:h2:tcp://localhost/~/datajpa`
    * `spring.datasource.driver-class-name`: `org.h2.Driver`
    * `spring.datasource.username`: `sa`
    * `spring.jpa.hibernate.ddl-auto`: `create`
    * `spring.jpa.properties.hibernate.show_sql`: `true`
    * `spring.jpa.properties.hibernate.format_sql`: `true`
* `spring.jpa.hibernate.ddl-auto: create` 옵션은 애플리케이션 실행 시점에 테이블을 drop 하고, 다시 생성합니다.
* 모든 로그 출력은 가급적 로거를 통해 남겨야 합니다.
    * `show_sql` 옵션은 `System.out`에 하이버네이트 실행 SQL을 남긴다.
    * `org.hibernate.SQL` 옵션은 `logger`를 통해 하이버네이트 실행 SQL을 남긴다.

## 쿼리 파라미터 로그 남기기
* `p6spy` 라이브러리를 사용하면 쿼리 파라미터를 로그로 남길 수 있습니다.
* 스프링 부트 3.0 이상을 사용하면 라이브러리 버전을 1.9.0 이상을 사용해야 합니다.
* **주의**: 쿼리 파라미터를 로그로 남기는 외부 라이브러리는 시스템 자원을 사용하므로, 개발 단계에서는 편하게 사용해도 되지만, 운영시스템에 적용하려면 꼭 성능테스트를 하고 사용하는 것이 좋습니다.

# 3. 공통 인터페이스 기능

## 순수 JPA 기반 리포지토리 만들기
* 순수한 JPA 기반 리포지토리를 만들어서 기본적인 CRUD 기능을 구현할 수 있습니다.
* **JPA에서 수정은 변경감지(Dirty Checking) 기능을 사용하면 됩니다.** 트랜잭션 안에서 엔티티를 조회한 다음에 데이터를 변경하면, 트랜잭션 종료 시점에 변경감지 기능이 작동해서 변경된 엔티티를 감지하고 UPDATE SQL을 실행합니다.

## 공통 인터페이스 설정
* 스프링 부트 사용시 `@SpringBootApplication` 위치를 지정하면 해당 패키지와 하위 패키지를 인식하기 때문에 별도의 설정이 필요 없습니다.
* 만약 위치가 달라지면 `@EnableJpaRepositories`가 필요합니다.
* 스프링 데이터 JPA는 `org.springframework.data.repository.Repository`를 구현한 클래스를 스캔 대상으로 합니다.
* `@Repository` 애노테이션을 생략할 수 있습니다.
    * 컴포넌트 스캔을 스프링 데이터 JPA가 자동으로 처리합니다.
    * JPA 예외를 스프링 예외로 변환하는 과정도 자동으로 처리합니다.

## 공통 인터페이스 적용
* 순수 JPA로 구현한 `MemberJpaRepository` 대신에 스프링 데이터 JPA가 제공하는 공통 인터페이스인 `JpaRepository`를 사용하면 편리하게 개발할 수 있습니다.
* `JpaRepository`를 상속받는 인터페이스를 만들기만 하면, 스프링 데이터 JPA가 구현 클래스를 동적으로 생성해줍니다.

## 공통 인터페이스 분석
* **`JpaRepository` 인터페이스**: 공통 CRUD를 제공합니다.
* **제네릭**: `<T: 엔티티 타입, ID: 식별자 타입(PK)>` 을 설정합니다.
* `JpaRepository`는 `PagingAndSortingRepository`를 상속받고, `PagingAndSortingRepository`는 `CrudRepository`를 상속받습니다.

### 주요 메서드
* `save(S)`: 새로운 엔티티는 저장하고 이미 있는 엔티티는 병합합니다.
* `delete(T)`: 엔티티 하나를 삭제합니다. 내부에서 `EntityManager.remove()`를 호출합니다.
* `findById(ID)`: 엔티티 하나를 조회합니다. 내부에서 `EntityManager.find()`를 호출합니다.
* `getOne(ID)`: 엔티티를 프록시로 조회합니다. 내부에서 `EntityManager.getReference()`를 호출합니다. (최신 버전에서는 `getReferenceById(ID)` 사용을 권장합니다.)
* `findAll(...)`: 모든 엔티티를 조회합니다. 정렬(Sort)이나 페이징(Pageable) 조건을 파라미터로 제공할 수 있습니다.
* **참고**: `JpaRepository`는 대부분의 공통 메서드를 제공합니다.
